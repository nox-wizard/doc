<HTML>
<HEAD>
<TITLE> Targetting </TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
</HEAD>
<BODY leftmargin="0" rightmargin="0"  topmargin="0" marginwidth="0" marginheight="0">
<TABLE WIDTH="100%" HEIGHT="100%" BORDER="0" cellpadding="0" cellspacing="0" >
	<TR HEIGHT=75 bgcolor=#125492> 
		<TD>
			<image src="logo.gif" >
			<font color="#FFFFFF" size="5" face="ArialBlack">
			version 0.82
			</FONT>
		</TD> 
	</TR>
	<TR HEIGHT=1 bgcolor=#808080><TD></TD></TR>
	<TR HEIGHT=1 bgcolor=#D4D0C8><TD></TD></TR>
	<TR HEIGHT=5 bgcolor=#FFFFFF><TD></TD></TR>
	<TR BGCOLOR=#FFFFFF ALIGN="left"> <TD VALIGN="top">
		<TABLE WIDTH=100% cellpadding="0" cellspacing="0">
			<TR>
				<TD WIDTH=30  VALIGN=top >
					<TABLE WIDTH=30 cellpadding="0" cellspacing="0">
						<TR HEIGHT=26 bgcolor=#FFFFFF><TD></TD></TR>
						<TR HEIGHT=1 bgcolor=#808080><TD></TD></TR>
						<TR HEIGHT=1 bgcolor=#D4D0C8><TD></TD></TR>
						<TR><TD></TD></TR>
					</TABLE>
				</TD>
				<TD>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1><a class="anchor" name="p_targetting">Targetting</a></h1>As an UO player you surely know what does "targetting" mean: you are targetting when you left click an item or character with the target pointer<br>
 Targetting is necessary to interact with the UO world, so in your scripts you surely will have to manage targetting<br>
 Here we'll discuss the question from NOX wizard scripter's point of view.<br>
<p>
Many times we refer to a target thinking it to be the object we selected with the targetting action.<br>
 For example when we attack someone we click on him and we say he is our target.<br>
 When you are scripting the question is a bit different<br>
 A target is an object wich allows us to manage the targetting action<br>
 You can create a target with:<p>
<div class="fragment"><pre><span class="keyword">new</span> target = <a class="code" href="group__script__API__target.html#ga0">target_create</a>(chr, _, _, _, <span class="stringliteral">"mycallback"</span>);
</pre></div><p>
click the link to know more on the target_create function parameters.<br>
 From the client point of view, this line of code causes the target pointer to appear, so this line will make the player able to click on something.<p>
When you create/activate a target the following things happen: <br>
 <ul>
<li>
the target is created for the character you specified </li>
<li>
the target notification is sent to the client </li>
<li>
the player clicks something </li>
<li>
the server receives a notification that something has been clicked </li>
<li>
the Small callback you specified is called to perform some actions </li>
</ul>
<p>
The only things you have to worry about are the first and last points, all the thing between are managed by the source code.<br>
 But analyzing the sequence you should notice a very important thing: the whole process is not purely sequential, that is, the operations are not performet one just after the other. Why? Because of the 3rd point! To go on with target management the server has to wait for the player to click something, and you will never know when this will happen!<br>
 This will have heavy consequences on how you will structure your code.<p>
Your callback function must have the following proptotype: public callback( const target, const chr, const obj, const x, const y, const z, const model, const param1 ) <b>target:</b> is the target wich called the function<br>
 <b>chr:</b> is the character who clicked on something<br>
 <b>object:</b> the item or character targetted, INVALID if no object targetted<br>
 <b>x,y,z:</b> if the player targetted the ground or other map locations, these are the coordinates, else x,y,z are INVALID<br>
 <b>model:</b> is valid when targetted an item or a static tile, not when a land tile is targetted<br>
 <b>param1:</b> is the first param passed<br>
 <b>param2:</b> passed to target_create can be getted using the target_getProperty, with TP_BUFFER and 1 for index<br>
<p>
As you can see in the callback you have all the parameters of the targetting action.<p>
After all this theoretical explanation what should you do to get this all working? The typical target code should be:<p>
<div class="fragment"><pre><span class="keyword">public</span> a_function(<span class="keyword">const</span> chr, ...)
{
        <a class="code" href="group__script__API__character__privs.html#ga24">chr_message</a>(chr, _, <span class="stringliteral">"Target something ..."</span>);
        <a class="code" href="group__script__API__target.html#ga0">target_create</a>(chr, _, _, _, <span class="stringliteral">"callback"</span>);
}

<span class="keyword">public</span> callback(target, chr, object, param1, x ,y ,z ,model, param1)
{
        <span class="comment">//do something here</span>
}
</pre></div><p>
This is all you need to manage a target, the first function will send the target to the character with a message and the callback will be activated on target use.<br>
 When you write code in the callback you have to take in consideration that the exact moment the function will be called is not known.<p>
You surely have noticed that we didn't use all target_create parameters, neither we used the target_do function. This features are for advanced target use. The first 2 additional parameters param1 and param2 are simply used to pass something to the callback wothout having to declare global variables/local vars, so that's not such an advanced used. the doNow paramter is mre interesting: it allows you to create the target (so getting a serial for it) without sending it to the player, simply use<p>
<div class="fragment"><pre><a class="code" href="group__script__API__target.html#ga0">target_create</a>(chr,_,_,<span class="keyword">false</span>,<span class="stringliteral">"callback"</span>);
</pre></div><p>
and your target won't be sent.<br>
 This feature allows you a complex target management, so you can create many targets with a function and then activate them when needed with <a class="el" href="group__script__API__target.html#ga1">target_do(target, chr)</a>. This way you can use the same target for more than one character too.<br>
 The additional parameters after the callback name are used to build the callback name at runtime.<p>
<div class="fragment"><pre>N = 10;
<span class="keyword">new</span> targets[N];
<span class="keywordflow">for</span>(<span class="keyword">new</span> i = 0; i&lt;N ; i++)
        targets[i] = <a class="code" href="group__script__API__target.html#ga0">target_create</a>(chr, _,_,_,<span class="stringliteral">"callback%d"</span>,i)   
</pre></div><p>
will create N targets that will have callbacks named callback0, callback1, callback2 ... and so on.<p>
All these interesting target features are available only from the newest 0.82 versions, those of you who are yousing the old system (with getTarget) will find that old system is no longer supported. You can easily switch to new system replacing your old<p>
<div class="fragment"><pre>getTarget(chr, <a class="code" href="core_8api.html#a1">funcidx</a>(<span class="stringliteral">"callback"</span>), <span class="stringliteral">"message"</span>);
</pre></div><p>
with the new<p>
<div class="fragment"><pre><a class="code" href="group__script__API__character__privs.html#ga24">chr_message</a>(chr,_,<span class="stringliteral">"message"</span>);
<a class="code" href="group__script__API__target.html#ga0">target_create</a>(chr,_,_,_,<span class="stringliteral">"callback"</span>);
</pre></div>				</TD>
				<TD WIDTH=30  VALIGN=top >
					<TABLE WIDTH=30 cellpadding="0" cellspacing="0">
						<TR HEIGHT=26 bgcolor=#FFFFFF><TD></TD></TR>
						<TR HEIGHT=1 bgcolor=#808080><TD></TD></TR>
						<TR HEIGHT=1 bgcolor=#D4D0C8><TD></TD></TR>
						<TR><TD></TD></TR>
					</TABLE>
				</TD>
			</TR>
		</TABLE>
		</TD> 
	</TR>
	<TR HEIGHT=5 bgcolor=#FFFFFF><TD></TD></TR>
	<TR HEIGHT=1 bgcolor=#D4D0C8><TD></TD></TR>
	<TR HEIGHT=1 bgcolor=#808080><TD></TD></TR>
	<TR HEIGHT=75 bgcolor=#125492 ALIGN=right> <TD>
		<font color="#FFFFFF" size="4" face="ArialBlack">
			Documentation generated 19 Feb 2004 &nbsp&nbsp
		</FONT>
	</TD> 
	</TR>
</TABLE>
</BODY>
</HTML>

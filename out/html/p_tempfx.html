<HTML>
<HEAD>
<TITLE> Tempfx use and abuse </TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
</HEAD>
<BODY leftmargin="0" rightmargin="0"  topmargin="0" marginwidth="0" marginheight="0">
<TABLE WIDTH="100%" HEIGHT="100%" BORDER="0" cellpadding="0" cellspacing="0" >
	<TR HEIGHT=75 bgcolor=#125492> 
		<TD>
			<image src="logo.gif" >
			<font color="#FFFFFF" size="5" face="ArialBlack">
			version 0.82
			</FONT>
		</TD> 
	</TR>
	<TR HEIGHT=1 bgcolor=#808080><TD></TD></TR>
	<TR HEIGHT=1 bgcolor=#D4D0C8><TD></TD></TR>
	<TR HEIGHT=5 bgcolor=#FFFFFF><TD></TD></TR>
	<TR BGCOLOR=#FFFFFF ALIGN="left"> <TD VALIGN="top">
		<TABLE WIDTH=100% cellpadding="0" cellspacing="0">
			<TR>
				<TD WIDTH=30  VALIGN=top >
					<TABLE WIDTH=30 cellpadding="0" cellspacing="0">
						<TR HEIGHT=26 bgcolor=#FFFFFF><TD></TD></TR>
						<TR HEIGHT=1 bgcolor=#808080><TD></TD></TR>
						<TR HEIGHT=1 bgcolor=#D4D0C8><TD></TD></TR>
						<TR><TD></TD></TR>
					</TABLE>
				</TD>
				<TD>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1><a class="anchor" name="p_tempfx">Tempfx use and abuse</a></h1>Here you'll learn about one of the most widely used features of NOX wizard: the tempfx<br>
 The functions we are talking about are:<p>
<pre class="fragment"><div>native <a class="code" href="group__script__API__tempfx.html#ga0">tempfx_activate</a>( <span class="keyword">const</span> type = TFX_AMXCUSTOM, <span class="keyword">const</span> chrsrc, <span class="keyword">const</span> chrdest, <span class="keyword">const</span> more, <span class="keyword">const</span> dur = -1, <span class="keyword">const</span> callback = -1);
native <a class="code" href="group__script__API__tempfx.html#ga1">tempfx_delete</a>(<span class="keyword">const</span> chr, <span class="keyword">const</span> type = TFX_AMXCUSTOM, <span class="keyword">const</span> doExpire = <span class="keyword">true</span>, <span class="keyword">const</span> callback = -1);
native <a class="code" href="group__script__API__tempfx.html#ga2">tempfx_isActive</a>(<span class="keyword">const</span> chr, <span class="keyword">const</span> type = TFX_AMXCUSTOM, <span class="keyword">const</span> callback = -1)
</div></pre><h2><a class="anchor" name="whataretempfxfor">
What are tempfx for?</a></h2>
Tempfx are used to say to the emulator: "Execute this function after this time has passed".<br>
 Tempfx have 2 kinds of use:<ul>
<li>A "standard" one wich is for playing some "effects" from a character to another, passing one of the predefined constants (in small-scripts/effects/constants.sma) as "type", this will performe one of the standard effects.</li><li>A "custom" one wich is used to execute a function after a determined time is passed.</li></ul>
<h2><a class="anchor" name="stdeffects">
Standard effects</a></h2>
For "standard" use there isn't much to say, simply call tempfx_activate passing the type of effect you want, putting in "more" the power of the effect. To manage the "more" parameter you should do a little work on it ... Only the 24 least significant bits are taken, and they are subdivided in 3 8bit numbers that affect the behaviour of the effect.<p>
So when setting "more" you should do the following:<p>
<pre class="fragment"><div><span class="keyword">new</span> more;
<span class="keyword">new</span> more1,more2,more3; <span class="comment">//assign something to theese vars</span>
more = more1 + (more2 &lt;&lt; 8) + (more3 &lt;&lt; 16);
</div></pre><p>
what more1, more2 and more3 mean depends on the "type" of effect. Description on the more* parameters can be found in the script_API_tempfx_constant description<h2><a class="anchor" name="customtempfx">
Custom tempfx</a></h2>
This is the most useful feature of tempfx, let's see how it works:<br>
 To use a custom tempfx you should pass TFX_AMXCUSTOM as "type" parameter, but as far as this is the default value, you can pass _ <br>
<ul>
<li>"dur" parameter indicates how long will it take for the tempfx to expire, in seconds</li><li>"more" is useless, unless you want this parameter passed to your callback</li><li>"callback" is the function that is called by the temp effect A typical call is:</li></ul>
<p>
<pre class="fragment"><div><span class="preprocessor">#define DELAY 5</span>
<span class="preprocessor"></span>...
tempfx_activate(_,chr,chr,0,DELAY,<a class="code" href="core_8api.html#a1">funcidx</a>(<span class="stringliteral">"mycallback"</span>));
</div></pre><h3><a class="anchor" name="tempfxprototype">
Callback function prototype</a></h3>
The function you want to call must have the following proptotype<p>
<pre class="fragment"><div><span class="keyword">public</span> mycallback(<span class="keyword">const</span> chrsrc, <span class="keyword">const</span> chrdest, <span class="keyword">const</span> power, <span class="keyword">const</span> mode)
</div></pre><p>
<ul>
<li>"chrsrc" and "chrdest" are those you have passed in the tempfx_activate call</li><li>"power" is the "more" parameter</li><li>"mode" needs some explanation</li></ul>
<p>
You function is called a lot of times before the tempfx expires, every time the "mode" parameter tells you the reason of the call. There are 5 different modes:<ul>
<li>TFXM_START = 0 the tempfx is started</li><li>TFXM_END = 1 the tempfx is expired (timeout)</li><li>TFXM_ON = 2 the tempfx is activated</li><li>TFXM_OFF = 3 the tempfx is deactivated</li><li>TFXM_REVERSE = 4 don't know ...</li></ul>
<p>
Usually you will need to call a function after a certain time has passed, so you will need only the TFXM_END mode.<br>
 This is a function that fires on the tempfx timeout<p>
<pre class="fragment"><div><span class="keyword">public</span> mycallback(<span class="keyword">const</span> chrsrc, <span class="keyword">const</span> chrdest, <span class="keyword">const</span> power, <span class="keyword">const</span> mode)
{
<span class="keywordflow">if</span> (mode != <a class="code" href="group__script__API__tempfx__constants.html#ga33">TFXM_END</a>) <span class="keywordflow">return</span>;
nprintf(getCharFromSocket(chrsrc),<span class="stringliteral">"You tempfx has expired"</span>);
}
</div></pre><p>
This is the standard structure of the tempfx callbacks, if you perform some operations before the check they will be executed a lot of times and you won't have control on it.<br>
 This way of using tempfx is useful to script all that things that need a timeout, such as skill/stats temporary bonuses, time bombs and so on<br>
<h2><a class="anchor" name="loops">
loops</a></h2>
Another interesting use of tempfx are loops, it's very simple to make a loop with tempfx: simply make your callback call the same tempfx:<p>
<pre class="fragment"><div><span class="preprocessor">#define DELAY 2</span>
<span class="preprocessor"></span><span class="keyword">public</span> mycallback(<span class="keyword">const</span> chrsrc, <span class="keyword">const</span> chrdest, <span class="keyword">const</span> power, <span class="keyword">const</span> mode)
{
<span class="keywordflow">if</span> (mode != <a class="code" href="group__script__API__tempfx__constants.html#ga33">TFXM_END</a>) <span class="keywordflow">return</span>;
<span class="comment">//</span>
<span class="comment">//some code here</span>
<span class="comment">//</span>
<a class="code" href="group__script__API__tempfx.html#ga0">tempfx_activate</a>(_,chrsrc,chrdst,power,DELAY,<a class="code" href="core_8api.html#a1">funcidx</a>(<span class="stringliteral">"mycallback"</span>));
}
</div></pre><p>
This function will be called every 2 seconds. Here you can notice the danger of putting some code before the TFXM_END check, if you do not put the check you will start a terrible sequence of loops out of control!<h2><a class="anchor" name="tipsandtricks">
TIPS &amp; TRICKS</a></h2>
Tempfx work only for chars, not for items, so what about putting a tempfx on an item? Usually you can find a character that can take the tempfx instead of the item, it can be the character that is using the item or something like that.<br>
 For example if you want a sword to lose HP every day (beacuse of rust) you can put the tempfx on the owner of the sword, no matter if the sword is given to someone else, the tempfx is linked to a char and it will fire anyway, the problem is that you can't pass additional parameters to the callback so when the tempfx fires you won't have information about your sword, and you won't be able to damage it. The solution is to store the serial of the sword in a localvar on the character, so your callback can read the sword's serial from there.<br>
 <br>
 NOTE: item tempfx of this kind stop working if the char is deleted... so this example is not completely right... but it's only an example.<br>
<p>
I described loops before, but those were infinite loops (as for hunger system), most times you will need to stop your loop under a certain condition.<br>
 Stopping a tempfx loop is simple... simply put<p>
<pre class="fragment"><div><span class="keywordflow">if</span>(stopcondition) <span class="keywordflow">return</span>;
</div></pre><p>
before the tempfx_activate call in your callback. Loops can be very computing expensive for you machine, so choose with care the looping delays and minimize the operations in the loop especially in loops that involve many characters, as hunger systems o regeneration systems. 				</TD>
				<TD WIDTH=30  VALIGN=top >
					<TABLE WIDTH=30 cellpadding="0" cellspacing="0">
						<TR HEIGHT=26 bgcolor=#FFFFFF><TD></TD></TR>
						<TR HEIGHT=1 bgcolor=#808080><TD></TD></TR>
						<TR HEIGHT=1 bgcolor=#D4D0C8><TD></TD></TR>
						<TR><TD></TD></TR>
					</TABLE>
				</TD>
			</TR>
		</TABLE>
		</TD> 
	</TR>
	<TR HEIGHT=5 bgcolor=#FFFFFF><TD></TD></TR>
	<TR HEIGHT=1 bgcolor=#D4D0C8><TD></TD></TR>
	<TR HEIGHT=1 bgcolor=#808080><TD></TD></TR>
	<TR HEIGHT=75 bgcolor=#125492 ALIGN=right> <TD>
		<font color="#FFFFFF" size="4" face="ArialBlack">
			Documentation generated 29 May 2004 &nbsp&nbsp
		</FONT>
	</TD> 
	</TR>
</TABLE>
</BODY>
</HTML>
